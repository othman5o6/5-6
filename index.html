<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لعبة الكنز الضائع - الإصدار المحسن</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Tajawal', sans-serif;
            margin: 0;
            padding: 0;
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            transition: background-color 0.5s, color 0.5s;
            background: linear-gradient(135deg, #1a0634, #2d0b5e);
        }

        body.light-mode {
            color: #333;
        }

        .background-dots {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }
        
        .dot {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            animation: float 15s infinite linear;
        }
        
        @keyframes float {
            0% {
                transform: translateY(0) translateX(0);
                opacity: 0.3;
            }
            50% {
                opacity: 0.5;
            }
            100% {
                transform: translateY(-100vh) translateX(100px);
                opacity: 0.3;
            }
        }

        .container {
            width: 100%;
            max-width: 800px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .header-controls {
            position: absolute;
            top: 15px;
            left: 15px;
            right: 15px;
            display: flex;
            justify-content: space-between;
            z-index: 10;
        }

        .control-btn {
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #ccc;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
        }

        .info-btn {
            color: gold;
            margin-right: 8px;
        }

        .settings-btn {
            color: #ff6b6b;
            margin-right: 8px;
        }

        .leaderboard-btn {
            color: #4dff4d;
            margin-right: 8px;
        }

        .toggle-theme {
            color: #3498db;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(15deg);
        }

        .header {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 15px 0 5px 0;
            width: 100%;
        }

        h1 {
            font-size: 2.2em;
            color: gold;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.7), 0 0 20px rgba(255, 215, 0, 0.5);
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            text-align: center;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .treasure-icon {
            font-size: 1.3em;
            animation: rotate 5s infinite linear;
        }

        @keyframes rotate {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(360deg); }
        }

        .stats-container {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 8px;
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            padding: 12px;
            border-radius: 12px;
            margin: 8px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        body.light-mode .stats-container {
            background: rgba(0, 0, 0, 0.05);
        }

        .stat-box {
            text-align: center;
            padding: 8px;
            border-radius: 8px;
            min-width: 90px;
            background: rgba(0, 0, 0, 0.3);
            flex: 1;
        }

        body.light-mode .stat-box {
            background: rgba(0, 0, 0, 0.1);
        }

        .stat-title {
            font-size: 0.9em;
            margin-bottom: 3px;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: gold;
            transition: transform 0.5s ease-out;
        }

        body.light-mode .stat-value {
            color: #8e44ad;
        }

        .points-animation {
            animation: pointsPop 0.5s ease-out;
        }

        @keyframes pointsPop {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }

        .game-controls {
            display: flex;
            gap: 12px;
            margin: 12px 0;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 40px;
            background: linear-gradient(to right, #8e44ad, #3498db);
            color: white;
            font-family: 'Tajawal', sans-serif;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }

        .btn:active {
            transform: translateY(1px);
        }

        .hint-btn {
            background: linear-gradient(to right, #27ae60, #2ecc71);
        }

        .hint-btn:disabled {
            background: linear-gradient(to right, #7f8c8d, #95a5a6);
            cursor: not-allowed;
        }

        .difficulty-selector {
            display: flex;
            gap: 8px;
            margin: 12px 0;
            flex-wrap: wrap;
            justify-content: center;
        }

        .difficulty-btn {
            padding: 8px 16px;
            border: 2px solid transparent;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-family: 'Tajawal', sans-serif;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s;
        }

        body.light-mode .difficulty-btn {
            background: rgba(0, 0, 0, 0.1);
            color: #333;
        }

        .difficulty-btn.active {
            background: linear-gradient(to right, #27ae60, #2ecc71);
            border-color: #fff;
            transform: scale(1.05);
            box-shadow: 0 0 12px rgba(46, 204, 113, 0.5);
        }

        .difficulty-btn.time-attack {
            background: linear-gradient(to right, #e74c3c, #c0392b);
        }

        .difficulty-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.2);
        }

        body.light-mode .difficulty-btn:hover:not(.active) {
            background: rgba(0, 0, 0, 0.15);
        }

        .grid-container {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            margin: 15px 0;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        body.light-mode .grid-container {
            background: rgba(0, 0, 0, 0.05);
        }

        .grid {
            display: grid;
            grid-gap: 10px;
            margin: 15px 0;
            transition: all 0.5s;
        }

        .cell {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            cursor: pointer;
            transition: all 0.5s ease;
            border-radius: 10px;
            box-shadow: inset 0 0 12px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            background: linear-gradient(145deg, #3a1378, #2d0b5e);
        }

        body.light-mode .cell {
            background: linear-gradient(145deg, #e0d6ff, #c5b8f0);
        }

        .cell::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            transform: rotate(30deg);
        }

        .cell:hover {
            transform: scale(1.05);
            box-shadow: 0 0 18px rgba(255, 215, 0, 0.4);
        }

        .cell.revealed {
            transform: scale(0.95);
        }

        .golden-treasure {
            background: radial-gradient(circle, #ffd700, #daa520) !important;
            box-shadow: 0 0 20px gold !important;
            animation: pulse-gold 1.5s infinite;
        }

        @keyframes pulse-gold {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .hint-very-hot {
            background: linear-gradient(145deg, #ff5252, #b33939) !important;
        }

        .hint-hot {
            background: linear-gradient(145deg, #42a5f5, #1976d2) !important;
        }

        .hint-cold {
            background: linear-gradient(145deg, #bdbdbd, #757575) !important;
        }

        .cell.fade-out {
            animation: fadeOut 0.8s ease forwards;
        }

        @keyframes fadeOut {
            to {
                opacity: 0;
                transform: scale(0.5);
            }
        }

        .rules {
            background: rgba(255, 255, 255, 0.08);
            padding: 20px;
            margin-top: 25px;
            border-radius: 18px;
            font-size: 1em;
            max-width: 600px;
            text-align: right;
            box-shadow: 0 5px 18px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            width: 100%;
        }

        body.light-mode .rules {
            background: rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .rules h2 {
            color: gold;
            margin-bottom: 12px;
            text-align: center;
            font-size: 1.5em;
        }

        body.light-mode .rules h2 {
            color: #8e44ad;
        }

        .rules ul {
            padding-right: 18px;
        }

        .rules li {
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .hint-red {
            color: #ff5252;
            font-weight: bold;
        }

        .hint-blue {
            color: #42a5f5;
            font-weight: bold;
        }

        .hint-gray {
            color: #bdbdbd;
            font-weight: bold;
        }

        .message-container {
            position: fixed;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            width: 95%;
            max-width: 450px;
            text-align: center;
        }

        .message {
            padding: 15px 25px;
            border-radius: 12px;
            margin-bottom: 12px;
            font-size: 1.2em;
            font-weight: bold;
            opacity: 0;
            transform: translateY(-100%);
            transition: all 0.4s;
            box-shadow: 0 5px 18px rgba(0, 0, 0, 0.3);
        }

        .message.show {
            opacity: 1;
            transform: translateY(0);
        }

        .message.win {
            background: linear-gradient(to right, #27ae60, #2ecc71);
        }

        .message.lose {
            background: linear-gradient(to right, #c0392b, #e74c3c);
        }

        .message.info {
            background: linear-gradient(to right, #3498db, #2980b9);
        }

        .start-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 30px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 22px;
            box-shadow: 0 8px 35px rgba(0, 0, 0, 0.5);
            max-width: 550px;
            margin: 15px;
            animation: fadeIn 1s;
        }

        body.light-mode .start-screen {
            background: rgba(255, 255, 255, 0.8);
            color: #333;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .start-screen h2 {
            font-size: 2.2em;
            color: gold;
            margin-bottom: 25px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.7);
        }

        body.light-mode .start-screen h2 {
            color: #8e44ad;
        }

        .start-screen p {
            font-size: 1.1em;
            margin-bottom: 20px;
            line-height: 1.7;
            max-width: 450px;
        }

        .hidden {
            display: none;
        }

        .info-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        body.light-mode .info-modal {
            background: rgba(0, 0, 0, 0.6);
        }

        .info-modal.show {
            opacity: 1;
            pointer-events: all;
        }

        .modal-content {
            background: linear-gradient(135deg, #2d0b5e, #1a0634);
            width: 90%;
            max-width: 500px;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            position: relative;
            animation: modalIn 0.5s;
            font-family: 'Tajawal', sans-serif;
        }

        body.light-mode .modal-content {
            background: linear-gradient(135deg, #f5f5ff, #e0e0ff);
            color: #333;
        }

        @keyframes modalIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .close-modal {
            position: absolute;
            top: 15px;
            left: 15px;
            font-size: 1.5em;
            cursor: pointer;
            color: #ff5252;
        }

        .modal-content h2 {
            text-align: center;
            margin-bottom: 20px;
            color: gold;
            font-family: 'Tajawal', sans-serif;
        }

        body.light-mode .modal-content h2 {
            color: #8e44ad;
        }

        .points-system {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
        }

        body.light-mode .points-system {
            background: rgba(0, 0, 0, 0.05);
        }

        .points-system h3 {
            color: gold;
            margin-bottom: 10px;
            text-align: center;
            font-family: 'Tajawal', sans-serif;
        }

        body.light-mode .points-system h3 {
            color: #8e44ad;
        }

        .points-system ul {
            list-style-type: none;
            padding: 0;
        }

        .points-system li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            font-family: 'Tajawal', sans-serif;
        }

        body.light-mode .points-system li {
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .points-system li:last-child {
            border-bottom: none;
        }

        .points-value {
            color: gold;
            font-weight: bold;
        }

        body.light-mode .points-value {
            color: #8e44ad;
        }
        
        /* نافذة الإعدادات */
        .settings-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        body.light-mode .settings-modal {
            background: rgba(0, 0, 0, 0.6);
        }

        .settings-modal.show {
            opacity: 1;
            pointer-events: all;
        }

        .settings-content {
            background: linear-gradient(135deg, #2d0b5e, #1a0634);
            width: 90%;
            max-width: 500px;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            position: relative;
            animation: modalIn 0.5s;
            font-family: 'Tajawal', sans-serif;
        }

        body.light-mode .settings-content {
            background: linear-gradient(135deg, #f5f5ff, #e0e0ff);
            color: #333;
        }

        .settings-section {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
        }

        body.light-mode .settings-section {
            background: rgba(0, 0, 0, 0.05);
        }

        .settings-title {
            font-size: 1.3em;
            margin-bottom: 15px;
            color: gold;
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: 'Tajawal', sans-serif;
        }

        body.light-mode .settings-title {
            color: #8e44ad;
        }

        .language-switch {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .lang-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid transparent;
            border-radius: 30px;
            background: rgba(0, 0, 0, 0.3);
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-family: 'Tajawal', sans-serif;
        }

        body.light-mode .lang-btn {
            background: rgba(0, 0, 0, 0.1);
            color: #333;
        }

        .lang-btn.active {
            background: linear-gradient(to right, #8e44ad, #3498db);
            border-color: #fff;
        }

        .font-size-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .size-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid transparent;
            border-radius: 30px;
            background: rgba(0, 0, 0, 0.3);
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            font-family: 'Tajawal', sans-serif;
        }

        body.light-mode .size-btn {
            background: rgba(0, 0, 0, 0.1);
            color: #333;
        }

        .size-btn.active {
            background: linear-gradient(to right, #27ae60, #2ecc71);
            border-color: #fff;
        }

        .background-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .bg-option {
            aspect-ratio: 1/1;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
            overflow: hidden;
            position: relative;
        }

        .bg-option.active {
            border-color: gold;
            transform: scale(0.95);
        }

        .bg-option span {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            padding: 5px;
            font-size: 0.8em;
            text-align: center;
        }

        .speed-test-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(to right, #8e44ad, #3498db);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            transition: background 0.3s;
            margin-top: 10px;
            font-weight: bold;
            font-family: 'Tajawal', sans-serif;
        }

        .speed-test-btn:hover {
            background: linear-gradient(to right, #7d3c98, #2980b9);
        }

        .speed-result {
            margin-top: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            text-align: center;
            display: none;
        }

        body.light-mode .speed-result {
            background: rgba(0, 0, 0, 0.1);
        }

        .coming-soon {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            text-align: center;
            font-style: italic;
            opacity: 0.8;
        }

        body.light-mode .coming-soon {
            background: rgba(0, 0, 0, 0.1);
        }

        /* لوحة المتصدرين */
        .leaderboard-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .leaderboard-modal.show {
            opacity: 1;
            pointer-events: all;
        }

        .leaderboard-content {
            background: linear-gradient(135deg, #2d0b5e, #1a0634);
            width: 90%;
            max-width: 500px;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            position: relative;
            animation: modalIn 0.5s;
            font-family: 'Tajawal', sans-serif;
        }

        .leaderboard-title {
            text-align: center;
            margin-bottom: 20px;
            color: gold;
            font-family: 'Tajawal', sans-serif;
        }

        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .leaderboard-table th {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            text-align: center;
        }

        .leaderboard-table td {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .leaderboard-table tr:last-child td {
            border-bottom: none;
        }

        .leaderboard-table tr:nth-child(even) {
            background: rgba(255, 255, 255, 0.05);
        }

        /* إعدادات الصوت */
        .sound-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .sound-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #2196F3;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .volume-slider {
            flex: 1;
            height: 8px;
            -webkit-appearance: none;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            outline: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
        }

        /* قصاصات ورقية */
        .confetti {
            position: fixed;
            top: -10px;
            width: 10px;
            height: 10px;
            opacity: 0;
            z-index: 9999;
            animation: confetti-fall 3s ease-in-out forwards;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* شاشة التحميل المؤقتة */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #1a0634;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            transition: opacity 0.5s;
        }
        
        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .loader {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 5px solid gold;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 1.2em;
            color: gold;
        }

        /* تصميم متجاوب */
        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }
            
            .start-screen h2 {
                font-size: 1.8em;
            }
            
            .stat-box {
                min-width: 80px;
                padding: 6px;
            }
            
            .stat-title {
                font-size: 0.8em;
            }
            
            .stat-value {
                font-size: 1.3em;
            }
            
            .rules {
                padding: 15px;
            }
            
            .grid-container {
                padding: 15px;
            }
            
            .btn {
                padding: 8px 16px;
                font-size: 0.9em;
            }
            
            .difficulty-selector {
                flex-wrap: wrap;
            }
            
            .difficulty-btn {
                font-size: 0.8em;
                padding: 6px 12px;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 1.6em;
            }
            
            .start-screen h2 {
                font-size: 1.6em;
            }
            
            .start-screen {
                padding: 20px;
            }
            
            .grid {
                grid-gap: 8px;
            }
            
            .cell {
                font-size: 18px;
            }
            
            .stat-box {
                min-width: 70px;
            }
            
            .stat-title {
                font-size: 0.75em;
            }
            
            .stat-value {
                font-size: 1.1em;
            }
            
            .difficulty-btn {
                padding: 6px 12px;
                font-size: 0.8em;
            }
            
            .rules {
                font-size: 0.9em;
            }
            
            .rules h2 {
                font-size: 1.3em;
            }
            
            .btn {
                padding: 8px 14px;
            }
            
            .message {
                padding: 12px 20px;
                font-size: 1em;
            }
            
            .settings-section {
                padding: 10px;
            }
        }

        @media (max-width: 360px) {
            h1 {
                font-size: 1.4em;
            }
            
            .start-screen h2 {
                font-size: 1.4em;
            }
            
            .grid {
                grid-gap: 6px;
            }
            
            .stat-box {
                min-width: 65px;
            }
            
            .rules {
                padding: 12px;
            }
        }
    </style>
</head>

<body class="dark-mode">
    <!-- شاشة التحميل المؤقتة -->
    <div class="loading-screen hidden" id="loadingScreen">
        <div class="loader"></div>
        <div class="loading-text" id="loadingText">جاري تحميل اللعبة...</div>
    </div>
    
    <!-- النقاط المتحركة في الخلفية -->
    <div class="background-dots" id="backgroundDots"></div>
    
    <div class="header-controls">
        <div>
            <div class="control-btn info-btn" id="infoBtn">
                <i class="fas fa-info-circle"></i>
            </div>
            <div class="control-btn settings-btn" id="settingsBtn">
                <i class="fas fa-cog"></i>
            </div>
            <div class="control-btn leaderboard-btn" id="leaderboardBtn">
                <i class="fas fa-trophy"></i>
            </div>
        </div>
        <div class="control-btn toggle-theme" onclick="toggleTheme()" id="themeBtn">
            <i class="fas fa-moon"></i>
        </div>
    </div>
    
    <div class="info-modal" id="infoModal">
        <div class="modal-content">
            <span class="close-modal" id="closeInfoModal">&times;</span>
            <h2 id="pointsSystemTitle"><i class="fas fa-star"></i> نظام النقاط</h2>
            <p id="pointsSystemDesc">في هذه اللعبة، يمكنك كسب النقاط بالطرق التالية:</p>
            
            <div class="points-system">
                <h3 id="pointsCalculationTitle">طريقة حساب النقاط</h3>
                <ul id="pointsCalculationList">
                    <li>
                        <span>النقاط الأساسية للفوز:</span>
                        <span class="points-value">500 نقطة</span>
                    </li>
                    <li>
                        <span>نقاط الوقت (لكل ثانية مبكرة):</span>
                        <span class="points-value">2 نقطة/ثانية</span>
                    </li>
                    <li>
                        <span>نقاط المحاولات المتبقية:</span>
                        <span class="points-value">100 نقطة/محاولة</span>
                    </li>
                    <li>
                        <span>مكافأة الصعوبة (مستوى صعب):</span>
                        <span class="points-value">+30%</span>
                    </li>
                    <li>
                        <span>نقاط وضع الهجوم الزمني (لكنز):</span>
                        <span class="points-value">200 نقطة</span>
                    </li>
                </ul>
            </div>
            
            <div class="points-system">
                <h3 id="pointsTipsTitle">نصائح لزيارة نقاطك</h3>
                <ul id="pointsTipsList">
                    <li><i class="fas fa-lightbulb"></i> ابحث بسرعة لتحصل على نقاط الوقت القصوى</li>
                    <li><i class="fas fa-lightbulb"></i> استخدم أقل عدد ممكن من المحاولات</li>
                    <li><i class="fas fa-lightbulb"></i> حاول لعب المستويات الصعبة لمكافآت أكبر</li>
                    <li><i class="fas fa-lightbulb"></i> استخدم التلميحات الملونة لتحديد موقع الكنز</li>
                    <li><i class="fas fa-lightbulb"></i> استخدم وضع الهجوم الزمني للحصول على نقاط إضافية</li>
                </ul>
            </div>
        </div>
    </div>
    
    <!-- نافذة الإعدادات -->
    <div class="settings-modal" id="settingsModal">
        <div class="settings-content">
            <span class="close-modal" id="closeSettingsModal">&times;</span>
            <h2 id="settingsTitle"><i class="fas fa-cog"></i> إعدادات اللعبة</h2>
            
            <div class="settings-section">
                <div class="settings-title" id="languageTitle">
                    <i class="fas fa-language"></i> تغيير اللغة
                </div>
                <div class="language-switch">
                    <button class="lang-btn active" data-lang="ar">
                        <span class="flag">🇸🇦</span> <span class="lang-text">العربية</span>
                    </button>
                    <button class="lang-btn" data-lang="en">
                        <span class="flag">🇬🇧</span> <span class="lang-text">English</span>
                    </button>
                </div>
            </div>
            
            <div class="settings-section">
                <div class="settings-title" id="fontSizeTitle">
                    <i class="fas fa-text-height"></i> حجم الخط
                </div>
                <div class="font-size-buttons">
                    <button class="size-btn" data-size="small"><span class="size-text">صغير</span></button>
                    <button class="size-btn active" data-size="medium"><span class="size-text">متوسط</span></button>
                    <button class="size-btn" data-size="large"><span class="size-text">كبير</span></button>
                </div>
            </div>
            
            <div class="settings-section">
                <div class="settings-title" id="backgroundTitle">
                    <i class="fas fa-image"></i> خلفية اللعبة
                </div>
                <div class="background-grid">
                    <div class="bg-option active" data-bg="purple" style="background: linear-gradient(135deg, #1a0634, #2d0b5e);">
                        <span class="bg-text">أرجواني</span>
                    </div>
                    <div class="bg-option" data-bg="blue" style="background: linear-gradient(135deg, #0d1b3e, #1d3557);">
                        <span class="bg-text">أزرق</span>
                    </div>
                    <div class="bg-option" data-bg="green" style="background: linear-gradient(135deg, #0d3e1a, #1d5735);">
                        <span class="bg-text">أخضر</span>
                    </div>
                    <div class="bg-option" data-bg="red" style="background: linear-gradient(135deg, #3e0d0d, #571d1d);">
                        <span class="bg-text">أحمر</span>
                    </div>
                    <div class="bg-option" data-bg="gold" style="background: linear-gradient(135deg, #3e2c0d, #57461d);">
                        <span class="bg-text">ذهبي</span>
                    </div>
                    <div class="bg-option" data-bg="black" style="background: linear-gradient(135deg, #000, #333);">
                        <span class="bg-text">أسود</span>
                    </div>
                </div>
            </div>
            
            <div class="settings-section">
                <div class="settings-title" id="soundSettingsTitle">
                    <i class="fas fa-volume-up"></i> إعدادات الصوت
                </div>
                <div class="sound-controls">
                    <div class="sound-toggle">
                        <span>تفعيل الصوت</span>
                        <label class="switch">
                            <input type="checkbox" id="soundToggle" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="volume-control">
                        <i class="fas fa-volume-down"></i>
                        <input type="range" min="0" max="1" step="0.1" value="0.7" class="volume-slider" id="volumeSlider">
                        <i class="fas fa-volume-up"></i>
                    </div>
                </div>
            </div>
            
            <div class="settings-section">
                <div class="settings-title" id="internetTestTitle">
                    <i class="fas fa-wifi"></i> اختبار قوة الإنترنت
                </div>
                <button class="speed-test-btn" id="speedTestBtn">
                    <i class="fas fa-bolt"></i> <span id="speedTestText">بدء الاختبار</span>
                </button>
                <div class="speed-result" id="speedResult">
                    <div id="downloadSpeed">التحميل: --</div>
                    <div id="uploadSpeed">الرفع: --</div>
                    <div id="pingResult">البنج: --</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- لوحة المتصدرين -->
    <div class="leaderboard-modal" id="leaderboardModal">
        <div class="leaderboard-content">
            <span class="close-modal" id="closeLeaderboardModal">&times;</span>
            <h2 class="leaderboard-title"><i class="fas fa-trophy"></i> لوحة المتصدرين</h2>
            
            <div class="difficulty-selector" id="leaderboardDifficulty">
                <button class="difficulty-btn active" data-level="easy" onclick="changeLeaderboardDifficulty('easy')">
                    <span class="difficulty-text">سهل</span>
                </button>
                <button class="difficulty-btn" data-level="medium" onclick="changeLeaderboardDifficulty('medium')">
                    <span class="difficulty-text">متوسط</span>
                </button>
                <button class="difficulty-btn" data-level="hard" onclick="changeLeaderboardDifficulty('hard')">
                    <span class="difficulty-text">صعب</span>
                </button>
                <button class="difficulty-btn time-attack" data-level="time-attack" onclick="changeLeaderboardDifficulty('time-attack')">
                    <span class="difficulty-text">هجوم زمني</span>
                </button>
            </div>
            
            <table class="leaderboard-table" id="leaderboardTable">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>اللاعب</th>
                        <th>النقاط</th>
                        <th>التاريخ</th>
                    </tr>
                </thead>
                <tbody id="leaderboardBody">
                    <!-- سيتم تعبئة البيانات من جافاسكريبت -->
                </tbody>
            </table>
            
            <button class="btn" onclick="clearLeaderboard()" style="margin-top: 20px; width: 100%;">
                <i class="fas fa-trash"></i> <span>مسح المتصدرين</span>
            </button>
        </div>
    </div>
  
    <div class="container">
        <div class="start-screen" id="startScreen">
            <h2 id="welcomeTitle">🏆 مرحباً في لعبة الكنز الضائع! 🪙</h2>
            <p id="welcomeDesc">
                مهمتك هي العثور على الكنز المخفي في أسرع وقت ممكن وبأقل عدد من المحاولات.
                استخدم التلميحات الملونة لمعرفة مدى قربك من الكنز، وكن حذراً فلديك عدد محدود من المحاولات!
            </p>
            <button class="btn" onclick="startGame()">
                <span id="startGameText">🎮 ابدأ اللعبة</span>
            </button>
        </div>
        
        <div class="game-container hidden" id="gameContainer">
            <div class="header">
                <h1><span id="gameTitle">لعبة الكنز الضائع</span> <span class="treasure-icon">🪙</span></h1>
                
                <div class="stats-container">
                    <div class="stat-box">
                        <div class="stat-title" id="attemptsTitle">المحاولات</div>
                        <div class="stat-value" id="attempts">0 / 5</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-title" id="timerTitle">الوقت</div>
                        <div class="stat-value" id="timer">00:00</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-title" id="pointsTitle">النقاط</div>
                        <div class="stat-value" id="points">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-title" id="winsLossesTitle">الفوز / الخسارة</div>
                        <div class="stat-value" id="winsLosses">0/0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-title" id="hintsTitle">التلميحات</div>
                        <div class="stat-value" id="hints">3</div>
                    </div>
                </div>
                
                <div class="game-controls">
                    <button class="btn" onclick="restartGame()">
                        <span id="restartText">🔄 إعادة تشغيل</span>
                    </button>
                    <button class="btn hint-btn" id="hintBtn" onclick="useHint()">
                        <i class="fas fa-lightbulb"></i> <span id="hintText">استخدم تلميحًا</span>
                    </button>
                </div>
                
                <div class="difficulty-selector">
                    <button class="difficulty-btn" data-level="easy" onclick="changeDifficulty('easy')">
                        <span class="difficulty-text">سهل</span>
                    </button>
                    <button class="difficulty-btn active" data-level="medium" onclick="changeDifficulty('medium')">
                        <span class="difficulty-text">متوسط</span>
                    </button>
                    <button class="difficulty-btn" data-level="hard" onclick="changeDifficulty('hard')">
                        <span class="difficulty-text">صعب</span>
                    </button>
                    <button class="difficulty-btn time-attack" data-level="time-attack" onclick="changeDifficulty('time-attack')">
                        <span class="difficulty-text">هجوم زمني</span>
                    </button>
                </div>
            </div>
            
            <div class="grid-container">
                <div class="grid" id="grid"></div>
            </div>
        </div>
        
        <div class="rules">
            <h2 id="rulesTitle">📜 قواعد اللعبة</h2>
            <ul id="rulesList">
                <li>📍 هناك خلية واحدة تحتوي على الكنز</li>
                <li>🧊 لديك عدد محدود من المحاولات للعثور عليه</li>
                <li>⏱️ حاول إيجاد الكنز في أسرع وقت لتحصل على نقاط أكثر</li>
                <li>💡 التلميحات بالألوان:
                    <ul>
                        <li class="hint-red">🔴 أحمر: قريب جداً من الكنز!</li>
                        <li class="hint-blue">🔵 أزرق: أنت قريب من الكنز</li>
                        <li class="hint-gray">⚪ رمادي: أنت بعيد عن الكنز</li>
                    </ul>
                </li>
                <li>🏆 كلما وجدت الكنز بشكل أسرع وبمحاولات أقل، كلما زادت نقاطك!</li>
                <li>💀 بعد الخسارة، سيظهر مكان الكنز لك</li>
                <li>⏰ وضع الهجوم الزمني: لديك 60 ثانية للعثور على أكبر عدد من الكنوز!</li>
                <li>💡 يمكنك استخدام 3 تلميحات لكل لعبة لتحديد اتجاه الكنز</li>
            </ul>
        </div>
    </div>
    
    <div class="message-container" id="messageContainer"></div>
    
    <!-- عناصر الصوت -->
    <audio id="clickSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-unlock-game-notification-253.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="winSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="loseSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-player-losing-or-failing-2042.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="hintSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-magic-sparkles-3003.mp3" type="audio/mpeg">
    </audio>
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <script>
        // إنشاء النقاط المتحركة في الخلفية
        function createBackgroundDots() {
            const container = document.getElementById('backgroundDots');
            container.innerHTML = '';
            
            for (let i = 0; i < 50; i++) {
                const dot = document.createElement('div');
                dot.className = 'dot';
                dot.style.left = `${Math.random() * 100}%`;
                dot.style.top = `${Math.random() * 100}%`;
                dot.style.width = `${Math.random() * 4 + 1}px`;
                dot.style.height = dot.style.width;
                dot.style.animationDelay = `${Math.random() * 15}s`;
                container.appendChild(dot);
            }
        }
        
        // عناصر DOM
        const grid = document.getElementById("grid");
        const attemptsDisplay = document.getElementById("attempts");
        const timerDisplay = document.getElementById("timer");
        const pointsDisplay = document.getElementById("points");
        const winsLossesDisplay = document.getElementById("winsLosses");
        const hintsDisplay = document.getElementById("hints");
        const messageContainer = document.getElementById("messageContainer");
        const gameContainer = document.getElementById("gameContainer");
        const startScreen = document.getElementById("startScreen");
        const infoBtn = document.getElementById("infoBtn");
        const infoModal = document.getElementById("infoModal");
        const closeInfoModal = document.getElementById("closeInfoModal");
        const settingsBtn = document.getElementById("settingsBtn");
        const settingsModal = document.getElementById("settingsModal");
        const closeSettingsModal = document.getElementById("closeSettingsModal");
        const leaderboardBtn = document.getElementById("leaderboardBtn");
        const leaderboardModal = document.getElementById("leaderboardModal");
        const closeLeaderboardModal = document.getElementById("closeLeaderboardModal");
        const speedTestBtn = document.getElementById("speedTestBtn");
        const speedResult = document.getElementById("speedResult");
        const downloadSpeed = document.getElementById("downloadSpeed");
        const uploadSpeed = document.getElementById("uploadSpeed");
        const pingResult = document.getElementById("pingResult");
        const loadingScreen = document.getElementById("loadingScreen");
        const loadingText = document.getElementById("loadingText");
        const hintBtn = document.getElementById("hintBtn");
        const soundToggle = document.getElementById("soundToggle");
        const volumeSlider = document.getElementById("volumeSlider");
        
        // عناصر الصوت
        const clickSound = document.getElementById("clickSound");
        const winSound = document.getElementById("winSound");
        const loseSound = document.getElementById("loseSound");
        const hintSound = document.getElementById("hintSound");
        
        // إعدادات اللعبة
        let maxAttempts = 5;
        let attempts = 0;
        let hints = 3;
        let treasureRow, treasureCol;
        let gameOver = false;
        let gameStarted = false;
        let timerInterval;
        let seconds = 0;
        let points = 0;
        let wins = 0;
        let losses = 0;
        let difficulty = "medium"; // المتوسط هو الافتراضي
        let currentLang = "ar";
        let currentTheme = "dark-mode";
        let currentBg = "purple";
        let soundEnabled = true;
        let volumeLevel = 0.7;
        let timeAttackMode = false;
        let treasuresFound = 0;
        let timeAttackTime = 60;

        // ألوان الخلفيات مع إصدارات فاتحة وداكنة
        const backgroundThemes = {
            purple: {
                dark: "linear-gradient(135deg, #1a0634, #2d0b5e)",
                light: "linear-gradient(135deg, #d9c7ff, #e6dcff)"
            },
            blue: {
                dark: "linear-gradient(135deg, #0d1b3e, #1d3557)",
                light: "linear-gradient(135deg, #c2d6ff, #d9e4ff)"
            },
            green: {
                dark: "linear-gradient(135deg, #0d3e1a, #1d5735)",
                light: "linear-gradient(135deg, #c7ffd9, #dcffe6)"
            },
            red: {
                dark: "linear-gradient(135deg, #3e0d0d, #571d1d)",
                light: "linear-gradient(135deg, #ffc2c2, #ffd9d9)"
            },
            gold: {
                dark: "linear-gradient(135deg, #3e2c0d, #57461d)",
                light: "linear-gradient(135deg, #ffe6b3, #fff0d9)"
            },
            black: {
                dark: "linear-gradient(135deg, #000, #333)",
                light: "linear-gradient(135deg, #555, #888)"
            }
        };

        // ألوان الخلايا لكل خلفية
        const cellThemes = {
            purple: {
                dark: "linear-gradient(145deg, #3a1378, #2d0b5e)",
                light: "linear-gradient(145deg, #d1c2f0, #c0a8e8)"
            },
            blue: {
                dark: "linear-gradient(145deg, #1d2b64, #15244e)",
                light: "linear-gradient(145deg, #b3c5ff, #a2b5f0)"
            },
            green: {
                dark: "linear-gradient(145deg, #1a5c2d, #134823)",
                light: "linear-gradient(145deg, #a8f0c2, #97e8b0)"
            },
            red: {
                dark: "linear-gradient(145deg, #5c1a1a, #481313)",
                light: "linear-gradient(145deg, #f0a8a8, #e89797)"
            },
            gold: {
                dark: "linear-gradient(145deg, #5c4a1a, #483913)",
                light: "linear-gradient(145deg, #f0d9a8, #e8c897)"
            },
            black: {
                dark: "linear-gradient(145deg, #222, #000)",
                light: "linear-gradient(145deg, #777, #555)"
            }
        };
        
        // إعدادات الصعوبة
        const difficultySettings = {
            easy: { size: 3, attempts: 5, cellSize: 80 },
            medium: { size: 5, attempts: 5, cellSize: 70 },
            hard: { size: 7, attempts: 5, cellSize: 50 },
            "time-attack": { size: 5, attempts: 9999, cellSize: 70 }
        };
        
        // لوحة المتصدرين
        let leaderboard = {
            "easy": [],
            "medium": [],
            "hard": [],
            "time-attack": []
        };
        
        // تهيئة اللعبة
        function initGame() {
            // إعادة تعيين المتغيرات
            attempts = 0;
            hints = 3;
            gameOver = false;
            seconds = 0;
            points = 0;
            treasuresFound = 0;
            timeAttackMode = difficulty === "time-attack";
            timeAttackTime = 60;
            
            // تحديث الشاشة
            attemptsDisplay.textContent = timeAttackMode ? `-- / --` : `0 / ${maxAttempts}`;
            timerDisplay.textContent = timeAttackMode ? "01:00" : "00:00";
            pointsDisplay.textContent = "0";
            hintsDisplay.textContent = hints;
            
            // إعداد الشبكة
            setupGrid();
            
            // اختيار موقع الكنز عشوائياً
            const size = difficultySettings[difficulty].size;
            treasureRow = Math.floor(Math.random() * size);
            treasureCol = Math.floor(Math.random() * size);
            
            // بدء المؤقت
            startTimer();
        }
        
        // بدء اللعبة
        function startGame() {
            // إظهار شاشة التحميل
            loadingScreen.classList.remove('hidden');
            
            setTimeout(() => {
                startScreen.classList.add("hidden");
                gameContainer.classList.remove("hidden");
                initGame();
                gameStarted = true;
                
                // إخفاء شاشة التحميل بعد بدء اللعبة
                loadingScreen.classList.add('hidden');
            }, 800);
        }
        
        // إعداد الشبكة
        function setupGrid() {
            grid.innerHTML = "";
            
            const settings = difficultySettings[difficulty];
            const size = settings.size;
            maxAttempts = settings.attempts;
            
            // تحديث عرض المحاولات
            attemptsDisplay.textContent = timeAttackMode ? `-- / --` : `0 / ${maxAttempts}`;
            
            // إنشاء الشبكة
            grid.style.gridTemplateColumns = `repeat(${size}, ${settings.cellSize}px)`;
            
            for (let r = 0; r < size; r++) {
                for (let c = 0; c < size; c++) {
                    const cell = document.createElement("div");
                    cell.className = "cell";
                    cell.dataset.row = r;
                    cell.dataset.col = c;
                    cell.style.width = `${settings.cellSize}px`;
                    cell.style.height = `${settings.cellSize}px`;
                    
                    // تطبيق لون الخلية المناسب
                    updateCellColor(cell);
                    
                    // إضافة تأثير التوهج عند التمرير
                    cell.addEventListener("mouseenter", function() {
                        if (!gameOver && !cell.classList.contains("revealed")) {
                            cell.style.boxShadow = "0 0 15px rgba(255, 215, 0, 0.6)";
                        }
                    });
                    
                    cell.addEventListener("mouseleave", function() {
                        cell.style.boxShadow = "inset 0 0 15px rgba(0, 0, 0, 0.3)";
                    });
                    
                    cell.addEventListener("click", handleClick);
                    grid.appendChild(cell);
                }
            }
        }
        
        // تحديث لون الخلايا حسب الخلفية والوضع
        function updateCellColor(cell) {
            const theme = currentTheme === "dark-mode" ? "dark" : "light";
            cell.style.background = cellThemes[currentBg][theme];
        }
        
        // التعامل مع النقر على الخلية
        function handleClick(e) {
            if (gameOver || !gameStarted) return;
            
            const cell = e.target;
            const row = +cell.dataset.row;
            const col = +cell.dataset.col;
            
            // إذا كانت الخلية مكشوفة بالفعل
            if (cell.classList.contains("revealed")) return;
            
            // تشغيل صوت النقر
            playSound(clickSound);
            
            // إضافة تأثير النقر
            cell.classList.add("revealed");
            cell.style.transform = "scale(0.95)";
            
            attempts++;
            const distance = Math.abs(row - treasureRow) + Math.abs(col - treasureCol);
            
            setTimeout(() => {
                cell.style.transform = "scale(1)";
                
                if (row === treasureRow && col === treasureCol) {
                    // وجد الكنز!
                    cell.textContent = "💰";
                    cell.classList.add("golden-treasure");
                    cell.style.fontSize = "30px";
                    
                    if (timeAttackMode) {
                        treasuresFound++;
                        points += 200;
                        pointsDisplay.textContent = points;
                        
                        // إعادة تعيين الخلايا
                        const cells = document.querySelectorAll('.cell');
                        cells.forEach(cell => {
                            cell.classList.remove('revealed');
                            cell.textContent = '';
                            cell.classList.remove('golden-treasure');
                            cell.classList.remove('hint-very-hot');
                            cell.classList.remove('hint-hot');
                            cell.classList.remove('hint-cold');
                        });
                        
                        // إضافة وقت إضافي
                        timeAttackTime += 10;
                        
                        // اختيار موقع جديد للكنز
                        const size = difficultySettings[difficulty].size;
                        treasureRow = Math.floor(Math.random() * size);
                        treasureCol = Math.floor(Math.random() * size);
                        
                        showMessage(`🎉 وجدت كنزًا! +10 ثوانٍ. الكنوز: ${treasuresFound}`, "win");
                        playSound(winSound);
                    } else {
                        gameOver = true;
                        wins++;
                        calculatePoints();
                        showMessage("🎉 مبروك! لقد وجدت الكنز!", "win");
                        playSound(winSound);
                        confetti();
                        updateStats();
                        saveToLeaderboard();
                    }
                } else {
                    // إظهار تلميح
                    if (distance === 1) {
                        cell.classList.add("hint-very-hot");
                    } else if (distance <= 2) {
                        cell.classList.add("hint-hot");
                    } else {
                        cell.classList.add("hint-cold");
                    }
                }
                
                attemptsDisplay.textContent = timeAttackMode ? `-- / --` : `${attempts} / ${maxAttempts}`;
                
                // التحقق من انتهاء المحاولات
                if (!timeAttackMode && attempts >= maxAttempts && !gameOver) {
                    gameOver = true;
                    losses++;
                    showMessage("❌ انتهت المحاولات! حاول مرة أخرى.", "lose");
                    playSound(loseSound);
                    updateStats();
                    saveToLeaderboard();
                    
                    // عرض مكان الكنز بعد الخسارة
                    revealTreasure();
                }
            }, 200);
        }
        
        // استخدام تلميح
        function useHint() {
            if (hints <= 0 || gameOver || !gameStarted) {
                showMessage("❌ لم يعد لديك تلميحات متبقية!", "info");
                return;
            }
            
            hints--;
            hintsDisplay.textContent = hints;
            playSound(hintSound);
            
            // حساب اتجاه الكنز
            const size = difficultySettings[difficulty].size;
            const centerRow = Math.floor(size / 2);
            const centerCol = Math.floor(size / 2);
            
            let direction = "";
            
            if (treasureRow < centerRow) direction += "أعلى";
            else if (treasureRow > centerRow) direction += "أسفل";
            
            if (treasureCol < centerCol) direction += " يسار";
            else if (treasureCol > centerCol) direction += " يمين";
            
            if (direction === "") direction = "في المركز";
            
            showMessage(`💡 التلميح: الكنز في اتجاه ${direction}`, "info");
        }
        
        // عرض مكان الكنز بعد الخسارة
        function revealTreasure() {
            const cells = document.querySelectorAll('.cell');
            cells.forEach(cell => {
                const row = +cell.dataset.row;
                const col = +cell.dataset.col;
                
                if (row === treasureRow && col === treasureCol) {
                    cell.textContent = "💰";
                    cell.classList.add("golden-treasure");
                    cell.style.fontSize = "30px";
                }
            });
        }
        
        // بدء المؤقت
        function startTimer() {
            clearInterval(timerInterval);
            seconds = 0;
            
            if (timeAttackMode) {
                seconds = timeAttackTime;
            }
            
            timerInterval = setInterval(() => {
                if (!gameOver) {
                    if (timeAttackMode) {
                        seconds--;
                        
                        if (seconds <= 0) {
                            seconds = 0;
                            gameOver = true;
                            losses++;
                            showMessage("⏰ انتهى الوقت! اللعبة انتهت.", "lose");
                            playSound(loseSound);
                            updateStats();
                            saveToLeaderboard();
                            revealTreasure();
                        }
                    } else {
                        seconds++;
                    }
                    
                    const minutes = Math.floor(seconds / 60);
                    const secs = seconds % 60;
                    timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                }
            }, 1000);
        }
        
        // حساب النقاط
        function calculatePoints() {
            // نقاط بناءً على الوقت والمحاولات المتبقية
            const timeBonus = Math.max(0, 300 - seconds) * 2; // 2 نقطة لكل ثانية مبكرة
            const attemptsBonus = (maxAttempts - attempts) * 100; // 100 نقطة لكل محاولة متبقية
            const basePoints = 500; // نقاط أساسية للفوز
            
            // مكافأة الصعوبة
            let difficultyBonus = 1;
            if (difficulty === "hard") difficultyBonus = 1.3;
            if (difficulty === "medium") difficultyBonus = 1.15;
            
            points = Math.floor((basePoints + timeBonus + attemptsBonus) * difficultyBonus);
            
            // تحديث النقاط مع تأثير الحركة
            animatePoints(points);
            updateStats();
        }
        
        // تحريك النقاط
        function animatePoints(finalPoints) {
            let currentPoints = parseInt(pointsDisplay.textContent) || 0;
            const increment = Math.ceil((finalPoints - currentPoints) / 20);
            
            const pointsInterval = setInterval(() => {
                currentPoints += increment;
                
                if (currentPoints >= finalPoints) {
                    currentPoints = finalPoints;
                    clearInterval(pointsInterval);
                }
                
                pointsDisplay.textContent = currentPoints;
                pointsDisplay.classList.add("points-animation");
                
                setTimeout(() => {
                    pointsDisplay.classList.remove("points-animation");
                }, 500);
            }, 50);
        }
        
        // إعادة تشغيل اللعبة
        function restartGame() {
            clearInterval(timerInterval);
            
            // أنيميشن إعادة التشغيل
            const cells = document.querySelectorAll('.cell');
            cells.forEach(cell => {
                cell.classList.add('fade-out');
            });
            
            setTimeout(() => {
                initGame();
            }, 800);
        }
        
        // تغيير مستوى الصعوبة
        function changeDifficulty(level) {
            difficulty = level;
            timeAttackMode = level === "time-attack";
            
            // تحديد الزر النشط
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.level === level);
            });
            
            restartGame();
        }
        
        // تغيير صعوبة لوحة المتصدرين
        function changeLeaderboardDifficulty(level) {
            document.querySelectorAll('#leaderboardDifficulty .difficulty-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.level === level);
            });
            
            updateLeaderboard(level);
        }
        
        // عرض رسالة
        function showMessage(text, type) {
            const message = document.createElement("div");
            message.className = `message ${type}`;
            message.textContent = text;
            messageContainer.appendChild(message);
            
            // إظهار الرسالة
            setTimeout(() => {
                message.classList.add("show");
            }, 10);
            
            // إخفاء الرسالة بعد 3 ثوانٍ
            setTimeout(() => {
                message.classList.remove("show");
                setTimeout(() => {
                    message.remove();
                }, 500);
            }, 3000);
        }
        
        // تحديث الإحصائيات
        function updateStats() {
            winsLossesDisplay.textContent = `${wins}/${losses}`;
        }
        
        // تبديل السمة (فاتح/غامق)
        function toggleTheme() {
            const body = document.body;
            const btn = document.getElementById("themeBtn");
            
            if (body.classList.contains("dark-mode")) {
                body.classList.remove("dark-mode");
                body.classList.add("light-mode");
                btn.innerHTML = '<i class="fas fa-sun"></i>';
                currentTheme = "light-mode";
            } else {
                body.classList.remove("light-mode");
                body.classList.add("dark-mode");
                btn.innerHTML = '<i class="fas fa-moon"></i>';
                currentTheme = "dark-mode";
            }
            
            // تحديث خلفية الجسم
            updateBodyBackground();
            
            // تحديث ألوان الخلايا
            document.querySelectorAll('.cell').forEach(updateCellColor);
        }
        
        // تحديث خلفية الجسم
        function updateBodyBackground() {
            const theme = currentTheme === "dark-mode" ? "dark" : "light";
            document.body.style.background = backgroundThemes[currentBg][theme];
        }
        
        // تشغيل الصوت
        function playSound(sound) {
            if (!soundEnabled) return;
            
            sound.volume = volumeLevel;
            sound.currentTime = 0;
            sound.play().catch(e => console.log("لم يتم تشغيل الصوت:", e));
        }
        
        // تأثيرات الفوز
        function confetti() {
            const duration = 3 * 1000;
            const animationEnd = Date.now() + duration;
            const defaults = { 
                startVelocity: 30, 
                spread: 360, 
                ticks: 60, 
                zIndex: 1000, 
                decay: 0.9,
                gravity: 0.5
            };
            
            function randomInRange(min, max) {
                return Math.random() * (max - min) + min;
            }
            
            // قصاصات ورقية ملونة
            const interval = setInterval(function() {
                const timeLeft = animationEnd - Date.now();
                
                if (timeLeft <= 0) {
                    return clearInterval(interval);
                }
                
                // قصاصات ورقية
                confettiLib({
                    particleCount: 30,
                    angle: 60,
                    spread: 55,
                    origin: { x: 0 },
                    ...defaults
                });
                
                confettiLib({
                    particleCount: 30,
                    angle: 120,
                    spread: 55,
                    origin: { x: 1 },
                    ...defaults
                });
                
                // قصاصات ذهبية
                confettiLib({
                    particleCount: 15,
                    angle: randomInRange(55, 125),
                    spread: 30,
                    origin: { x: 0.5, y: 0 },
                    colors: ['#ffd700', '#daa520', '#ffdf00'],
                    ...defaults
                });
            }, 200);
        }
        
        // اختبار سرعة الإنترنت
        function testInternetSpeed() {
            speedTestBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ' + 
                (currentLang === "ar" ? "جاري الاختبار..." : "Testing...");
            speedTestBtn.disabled = true;
            
            // محاكاة اختبار السرعة
            setTimeout(() => {
                const download = (Math.random() * 100).toFixed(2);
                const upload = (Math.random() * 50).toFixed(2);
                const ping = Math.floor(Math.random() * 100);
                
                downloadSpeed.textContent = (currentLang === "ar" ? "التحميل: " : "Download: ") + download + " Mbps";
                uploadSpeed.textContent = (currentLang === "ar" ? "الرفع: " : "Upload: ") + upload + " Mbps";
                pingResult.textContent = (currentLang === "ar" ? "البنج: " : "Ping: ") + ping + " ms";
                
                speedResult.style.display = 'block';
                document.getElementById("speedTestText").textContent = currentLang === "ar" ? "بدء الاختبار" : "Test Speed";
                speedTestBtn.innerHTML = '<i class="fas fa-bolt"></i> ' + 
                    (currentLang === "ar" ? "بدء الاختبار" : "Test Speed");
                speedTestBtn.disabled = false;
            }, 2000);
        }
        
        // حفظ النتيجة في لوحة المتصدرين
        function saveToLeaderboard() {
            // تحميل لوحة المتصدرين من localStorage
            const savedLeaderboard = localStorage.getItem('treasureLeaderboard');
            if (savedLeaderboard) {
                leaderboard = JSON.parse(savedLeaderboard);
            }
            
            // إنشاء سجل جديد
            const record = {
                player: "اللاعب",
                points: points,
                date: new Date().toLocaleDateString('ar-EG')
            };
            
            // إضافة السجل إلى القائمة المناسبة
            leaderboard[difficulty].push(record);
            
            // ترتيب القائمة حسب النقاط (تنازلياً)
            leaderboard[difficulty].sort((a, b) => b.points - a.points);
            
            // الحفاظ على أفضل 5 نتائج فقط
            leaderboard[difficulty] = leaderboard[difficulty].slice(0, 5);
            
            // حفظ لوحة المتصدرين في localStorage
            localStorage.setItem('treasureLeaderboard', JSON.stringify(leaderboard));
        }
        
        // تحديث لوحة المتصدرين
        function updateLeaderboard(difficultyLevel) {
            // تحميل لوحة المتصدرين من localStorage
            const savedLeaderboard = localStorage.getItem('treasureLeaderboard');
            if (savedLeaderboard) {
                leaderboard = JSON.parse(savedLeaderboard);
            }
            
            const leaderboardBody = document.getElementById("leaderboardBody");
            leaderboardBody.innerHTML = '';
            
            if (leaderboard[difficultyLevel].length === 0) {
                leaderboardBody.innerHTML = `<tr><td colspan="4" style="text-align: center;">لا توجد نتائج مسجلة</td></tr>`;
                return;
            }
            
            leaderboard[difficultyLevel].forEach((record, index) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${record.player}</td>
                    <td>${record.points}</td>
                    <td>${record.date}</td>
                `;
                leaderboardBody.appendChild(row);
            });
        }
        
        // مسح لوحة المتصدرين
        function clearLeaderboard() {
            if (confirm("هل أنت متأكد أنك تريد مسح جميع سجلات المتصدرين؟")) {
                leaderboard = {
                    "easy": [],
                    "medium": [],
                    "hard": [],
                    "time-attack": []
                };
                
                localStorage.setItem('treasureLeaderboard', JSON.stringify(leaderboard));
                updateLeaderboard(document.querySelector('#leaderboardDifficulty .difficulty-btn.active').dataset.level);
            }
        }
        
        // التبديل إلى الإنجليزية
        function switchToEnglish() {
            currentLang = "en";
            document.documentElement.lang = 'en';
            document.documentElement.dir = 'ltr';
            
            // تحديث النصوص
            document.getElementById("gameTitle").textContent = 'Lost Treasure Game';
            document.getElementById("welcomeTitle").textContent = '🏆 Welcome to Lost Treasure Game! 🪙';
            document.getElementById("welcomeDesc").textContent = 'Your mission is to find the hidden treasure as quickly as possible with as few attempts as possible. Use the colored hints to determine how close you are to the treasure, but be careful - you have a limited number of attempts!';
            document.getElementById("startGameText").textContent = '🎮 Start Game';
            document.getElementById("attemptsTitle").textContent = 'Attempts';
            document.getElementById("timerTitle").textContent = 'Time';
            document.getElementById("pointsTitle").textContent = 'Points';
            document.getElementById("winsLossesTitle").textContent = 'Wins/Losses';
            document.getElementById("hintsTitle").textContent = 'Hints';
            document.getElementById("rulesTitle").textContent = '📜 Game Rules';
            document.getElementById("rulesList").innerHTML = `
                <li>📍 There is one cell that contains the treasure</li>
                <li>🧊 You have a limited number of attempts to find it</li>
                <li>⏱️ Try to find the treasure as quickly as possible to get more points</li>
                <li>💡 Color hints:
                    <ul>
                        <li class="hint-red">🔴 Red: Very close to the treasure!</li>
                        <li class="hint-blue">🔵 Blue: You are close to the treasure</li>
                        <li class="hint-gray">⚪ Gray: You are far from the treasure</li>
                    </ul>
                </li>
                <li>🏆 The faster you find the treasure and the fewer attempts you use, the more points you get!</li>
                <li>💀 After losing, the treasure location will be revealed</li>
                <li>⏰ Time Attack mode: You have 60 seconds to find as many treasures as possible!</li>
                <li>💡 You can use 3 hints per game to determine the direction of the treasure</li>
            `;
            document.querySelectorAll('.difficulty-text')[0].textContent = 'Easy';
            document.querySelectorAll('.difficulty-text')[1].textContent = 'Medium';
            document.querySelectorAll('.difficulty-text')[2].textContent = 'Hard';
            document.querySelectorAll('.difficulty-text')[3].textContent = 'Time Attack';
            document.getElementById("restartText").textContent = '🔄 Restart';
            document.getElementById("hintText").textContent = 'Use a Hint';
            document.getElementById("settingsTitle").textContent = '<i class="fas fa-cog"></i> Game Settings';
            document.getElementById("languageTitle").innerHTML = '<i class="fas fa-language"></i> Change Language';
            document.getElementById("fontSizeTitle").innerHTML = '<i class="fas fa-text-height"></i> Font Size';
            document.getElementById("backgroundTitle").innerHTML = '<i class="fas fa-image"></i> Game Background';
            document.getElementById("soundSettingsTitle").innerHTML = '<i class="fas fa-volume-up"></i> Sound Settings';
            document.getElementById("internetTestTitle").innerHTML = '<i class="fas fa-wifi"></i> Internet Speed Test';
            document.querySelector('.sound-toggle span').textContent = 'Enable Sound';
            document.getElementById("speedTestText").textContent = 'Test Speed';
            document.getElementById("loadingText").textContent = 'Loading game...';
            document.getElementById("pointsSystemTitle").innerHTML = '<i class="fas fa-star"></i> Points System';
            document.getElementById("pointsSystemDesc").textContent = 'In this game, you can earn points in the following ways:';
            document.getElementById("pointsCalculationTitle").textContent = 'Points Calculation';
            document.getElementById("pointsCalculationList").innerHTML = `
                <li>
                    <span>Base points for winning:</span>
                    <span class="points-value">500 points</span>
                </li>
                <li>
                    <span>Time points (for each second early):</span>
                    <span class="points-value">2 points/second</span>
                </li>
                <li>
                    <span>Remaining attempts points:</span>
                    <span class="points-value">100 points/attempt</span>
                </li>
                <li>
                    <span>Difficulty bonus (hard level):</span>
                    <span class="points-value">+30%</span>
                </li>
                <li>
                    <span>Time Attack points (per treasure):</span>
                    <span class="points-value">200 points</span>
                </li>
            `;
            document.getElementById("pointsTipsTitle").textContent = 'Tips to increase your points';
            document.getElementById("pointsTipsList").innerHTML = `
                <li><i class="fas fa-lightbulb"></i> Search quickly to get maximum time points</li>
                <li><i class="fas fa-lightbulb"></i> Use as few attempts as possible</li>
                <li><i class="fas fa-lightbulb"></i> Try playing difficult levels for greater rewards</li>
                <li><i class="fas fa-lightbulb"></i> Use colored hints to locate the treasure</li>
                <li><i class="fas fa-lightbulb"></i> Use Time Attack mode for extra points</li>
            `;
        }
        
        // التبديل إلى العربية
        function switchToArabic() {
            currentLang = "ar";
            document.documentElement.lang = 'ar';
            document.documentElement.dir = 'rtl';
            
            // تحديث النصوص
            document.getElementById("gameTitle").textContent = 'لعبة الكنز الضائع';
            document.getElementById("welcomeTitle").textContent = '🏆 مرحباً في لعبة الكنز الضائع! 🪙';
            document.getElementById("welcomeDesc").textContent = 'مهمتك هي العثور على الكنز المخفي في أسرع وقت ممكن وبأقل عدد من المحاولات. استخدم التلميحات الملونة لمعرفة مدى قربك من الكنز، وكن حذراً فلديك عدد محدود من المحاولات!';
            document.getElementById("startGameText").textContent = '🎮 ابدأ اللعبة';
            document.getElementById("attemptsTitle").textContent = 'المحاولات';
            document.getElementById("timerTitle").textContent = 'الوقت';
            document.getElementById("pointsTitle").textContent = 'النقاط';
            document.getElementById("winsLossesTitle").textContent = 'الفوز / الخسارة';
            document.getElementById("hintsTitle").textContent = 'التلميحات';
            document.getElementById("rulesTitle").textContent = '📜 قواعد اللعبة';
            document.getElementById("rulesList").innerHTML = `
                <li>📍 هناك خلية واحدة تحتوي على الكنز</li>
                <li>🧊 لديك عدد محدود من المحاولات للعثور عليه</li>
                <li>⏱️ حاول إيجاد الكنز في أسرع وقت لتحصل على نقاط أكثر</li>
                <li>💡 التلميحات بالألوان:
                    <ul>
                        <li class="hint-red">🔴 أحمر: قريب جداً من الكنز!</li>
                        <li class="hint-blue">🔵 أزرق: أنت قريب من الكنز</li>
                        <li class="hint-gray">⚪ رمادي: أنت بعيد عن الكنز</li>
                    </ul>
                </li>
                <li>🏆 كلما وجدت الكنز بشكل أسرع وبمحاولات أقل، كلما زادت نقاطك!</li>
                <li>💀 بعد الخسارة، سيظهر مكان الكنز لك</li>
                <li>⏰ وضع الهجوم الزمني: لديك 60 ثانية للعثور على أكبر عدد من الكنوز!</li>
                <li>💡 يمكنك استخدام 3 تلميحات لكل لعبة لتحديد اتجاه الكنز</li>
            `;
            document.querySelectorAll('.difficulty-text')[0].textContent = 'سهل';
            document.querySelectorAll('.difficulty-text')[1].textContent = 'متوسط';
            document.querySelectorAll('.difficulty-text')[2].textContent = 'صعب';
            document.querySelectorAll('.difficulty-text')[3].textContent = 'هجوم زمني';
            document.getElementById("restartText").textContent = '🔄 إعادة تشغيل';
            document.getElementById("hintText").textContent = 'استخدم تلميحًا';
            document.getElementById("settingsTitle").innerHTML = '<i class="fas fa-cog"></i> إعدادات اللعبة';
            document.getElementById("languageTitle").innerHTML = '<i class="fas fa-language"></i> تغيير اللغة';
            document.getElementById("fontSizeTitle").innerHTML = '<i class="fas fa-text-height"></i> حجم الخط';
            document.getElementById("backgroundTitle").innerHTML = '<i class="fas fa-image"></i> خلفية اللعبة';
            document.getElementById("soundSettingsTitle").innerHTML = '<i class="fas fa-volume-up"></i> إعدادات الصوت';
            document.getElementById("internetTestTitle").innerHTML = '<i class="fas fa-wifi"></i> اختبار قوة الإنترنت';
            document.querySelector('.sound-toggle span').textContent = 'تفعيل الصوت';
            document.getElementById("speedTestText").textContent = 'بدء الاختبار';
            document.getElementById("loadingText").textContent = 'جاري تحميل اللعبة...';
            document.getElementById("pointsSystemTitle").innerHTML = '<i class="fas fa-star"></i> نظام النقاط';
            document.getElementById("pointsSystemDesc").textContent = 'في هذه اللعبة، يمكنك كسب النقاط بالطرق التالية:';
            document.getElementById("pointsCalculationTitle").textContent = 'طريقة حساب النقاط';
            document.getElementById("pointsCalculationList").innerHTML = `
                <li>
                    <span>النقاط الأساسية للفوز:</span>
                    <span class="points-value">500 نقطة</span>
                </li>
                <li>
                    <span>نقاط الوقت (لكل ثانية مبكرة):</span>
                    <span class="points-value">2 نقطة/ثانية</span>
                </li>
                <li>
                    <span>نقاط المحاولات المتبقية:</span>
                    <span class="points-value">100 نقطة/محاولة</span>
                </li>
                <li>
                    <span>مكافأة الصعوبة (مستوى صعب):</span>
                    <span class="points-value">+30%</span>
                </li>
                <li>
                    <span>نقاط وضع الهجوم الزمني (لكنز):</span>
                    <span class="points-value">200 نقطة</span>
                </li>
            `;
            document.getElementById("pointsTipsTitle").textContent = 'نصائح لزيارة نقاطك';
            document.getElementById("pointsTipsList").innerHTML = `
                <li><i class="fas fa-lightbulb"></i> ابحث بسرعة لتحصل على نقاط الوقت القصوى</li>
                <li><i class="fas fa-lightbulb"></i> استخدم أقل عدد ممكن من المحاولات</li>
                <li><i class="fas fa-lightbulb"></i> حاول لعب المستويات الصعبة لمكافآت أكبر</li>
                <li><i class="fas fa-lightbulb"></i> استخدم التلميحات الملونة لتحديد موقع الكنز</li>
                <li><i class="fas fa-lightbulb"></i> استخدم وضع الهجوم الزمني للحصول على نقاط إضافية</li>
            `;
        }
        
        // تهيئة التطبيق عند التحميل
        document.addEventListener('DOMContentLoaded', () => {
            // إنشاء النقاط المتحركة في الخلفية
            createBackgroundDots();
            
            // تحميل إعدادات الصوت
            const savedSoundSettings = localStorage.getItem('soundSettings');
            if (savedSoundSettings) {
                const settings = JSON.parse(savedSoundSettings);
                soundEnabled = settings.enabled;
                volumeLevel = settings.volume;
                soundToggle.checked = soundEnabled;
                volumeSlider.value = volumeLevel;
            }
            
            // فتح وإغلاق نافذة المعلومات
            infoBtn.addEventListener('click', () => {
                infoModal.classList.add('show');
            });
            
            closeInfoModal.addEventListener('click', () => {
                infoModal.classList.remove('show');
            });
            
            // فتح وإغلاق نافذة الإعدادات
            settingsBtn.addEventListener('click', () => {
                settingsModal.classList.add('show');
            });
            
            closeSettingsModal.addEventListener('click', () => {
                settingsModal.classList.remove('show');
            });
            
            // فتح وإغلاق لوحة المتصدرين
            leaderboardBtn.addEventListener('click', () => {
                leaderboardModal.classList.add('show');
                const activeDifficulty = document.querySelector('#leaderboardDifficulty .difficulty-btn.active').dataset.level;
                updateLeaderboard(activeDifficulty);
            });
            
            closeLeaderboardModal.addEventListener('click', () => {
                leaderboardModal.classList.remove('show');
            });
            
            // إغلاق النوافذ عند النقر خارجها
            window.addEventListener('click', (e) => {
                if (e.target === infoModal) {
                    infoModal.classList.remove('show');
                }
                if (e.target === settingsModal) {
                    settingsModal.classList.remove('show');
                }
                if (e.target === leaderboardModal) {
                    leaderboardModal.classList.remove('show');
                }
            });
            
            // اختبار سرعة الإنترنت
            speedTestBtn.addEventListener('click', testInternetSpeed);
            
            // تغيير حجم الخط
            document.querySelectorAll('.size-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.size-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    const size = this.dataset.size;
                    document.body.style.fontSize = 
                        size === 'small' ? '14px' : 
                        size === 'medium' ? '16px' : '20px';
                });
            });
            
            // تغيير الخلفية
            document.querySelectorAll('.bg-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.bg-option').forEach(o => o.classList.remove('active'));
                    this.classList.add('active');
                    
                    currentBg = this.dataset.bg;
                    updateBodyBackground();
                    
                    // تحديث ألوان الخلايا
                    document.querySelectorAll('.cell').forEach(updateCellColor);
                });
            });
            
            // تغيير اللغة
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    if(this.dataset.lang === "en") {
                        switchToEnglish();
                    } else {
                        switchToArabic();
                    }
                });
            });
            
            // التحكم في الصوت
            soundToggle.addEventListener('change', function() {
                soundEnabled = this.checked;
                
                // حفظ إعدادات الصوت
                localStorage.setItem('soundSettings', JSON.stringify({
                    enabled: soundEnabled,
                    volume: volumeLevel
                }));
            });
            
            volumeSlider.addEventListener('input', function() {
                volumeLevel = parseFloat(this.value);
                
                // حفظ إعدادات الصوت
                localStorage.setItem('soundSettings', JSON.stringify({
                    enabled: soundEnabled,
                    volume: volumeLevel
                }));
            });
            
            // تحديث الإحصائيات
            updateStats();
            
            // إخفاء شاشة التحميل بعد تحميل الصفحة
            setTimeout(() => {
                loadingScreen.classList.add('hidden');
            }, 1000);
        });
    </script>
</body>

</html>
