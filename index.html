<body>
  <h1>لعبة الكنز الضائع</h1>
  <button id="themeToggle">🌓</button>
  <div id="attemptCounter">المحاولات: <span id="attempts">0</span> / <span id="maxAttempts">5</span></div>
  <div class="grid-wrapper">
    <div id="grid"></div>
  </div>
  <div id="message"></div>
  <div id="confetti"></div>
  <div id="overlay">
    <p>مبروك! لقد فزت بالمستوى الأول! 🎉</p>
    <button onclick="resetGame()">إعادة اللعب</button>
  </div>

  <div id="rules">
    <h2>قواعد اللعبة:</h2>
    <ul>
      <li>هناك خلية واحدة تحتوي على الكنز 🪙</li>
      <li>لديك 5 محاولات فقط للعثور عليه!</li>
      <li>التلميحات بالألوان:
        <ul>
          <li><strong style="color: red">أحمر</strong>: قريب جدًا</li>
          <li><strong style="color: #3498db">أزرق</strong>: قريب</li>
          <li><strong style="color: #ffffff">أبيض</strong>: بعيد</li>
        </ul>
      </li>
    </ul>
  </div>

  <script>
    const gridSize = 5;
    const maxAttempts = 5;
    let treasureIndex;
    let attempts = 0;

    const grid = document.getElementById("grid");
    const attemptsDisplay = document.getElementById("attempts");
    const maxAttemptsDisplay = document.getElementById("maxAttempts");
    const message = document.getElementById("message");
    const confetti = document.getElementById("confetti");
    const overlay = document.getElementById("overlay");

    maxAttemptsDisplay.textContent = maxAttempts;

    function createGrid() {
      grid.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;
      grid.innerHTML = "";
      for (let i = 0; i < gridSize * gridSize; i++) {
        const cell = document.createElement("div");
        cell.classList.add("cell");
        cell.addEventListener("click", () => handleCellClick(i, cell));
        grid.appendChild(cell);
      }
      treasureIndex = Math.floor(Math.random() * gridSize * gridSize);
    }

    function handleCellClick(index, cell) {
      if (cell.classList.contains("treasure") || attempts >= maxAttempts) return;
      attempts++;
      attemptsDisplay.textContent = attempts;

      if (index === treasureIndex) {
        cell.classList.add("treasure");
        message.textContent = "🎉 لقد وجدت الكنز!";
        message.classList.add("show");
        showOverlay();
        throwConfetti();
      } else {
        const distance = getDistance(index, treasureIndex);
        cell.classList.add(getHintClass(distance));
      }
    }

    function getDistance(i1, i2) {
      const x1 = i1 % gridSize;
      const y1 = Math.floor(i1 / gridSize);
      const x2 = i2 % gridSize;
      const y2 = Math.floor(i2 / gridSize);
      return Math.abs(x1 - x2) + Math.abs(y1 - y2);
    }

    function getHintClass(distance) {
      if (distance <= 1) return "hot";
      if (distance <= 2) return "warm";
      return "cold";
    }

    function throwConfetti() {
      for (let i = 0; i < 80; i++) {
        const piece = document.createElement("div");
        piece.classList.add("confetti-piece");
        piece.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
        piece.style.left = `${Math.random() * 100}vw`;
        piece.style.top = `-${Math.random() * 20 + 10}px`;
        piece.style.animationDelay = `${Math.random()}s`;
        piece.style.transform = `rotate(${Math.random() * 360}deg)`;
        confetti.appendChild(piece);
        setTimeout(() => confetti.removeChild(piece), 3000);
      }
    }

    function showOverlay() {
      overlay.style.display = "flex";
    }

    function resetGame() {
      attempts = 0;
      attemptsDisplay.textContent = attempts;
      message.classList.remove("show");
      overlay.style.display = "none";
      confetti.innerHTML = "";
      createGrid();
    }

    document.getElementById("themeToggle").addEventListener("click", () => {
      document.body.classList.toggle("light");
    });

    createGrid();
  </script>
</body>
